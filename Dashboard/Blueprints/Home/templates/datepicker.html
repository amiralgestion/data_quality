<div class="relative flex space-x-2">
    <div class="relative w-1/3">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
            <i class="fa-solid fa-calendar text-gray-400"></i>
        </span>
        <input type="text" id="startDate" class="w-full pl-10 p-1.5 border border-gray-600 rounded bg-gray-800 text-white" placeholder="Date de dÃ©but" readonly>
    </div>
    <div class="relative w-1/3">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
            <i class="fa-solid fa-calendar text-gray-400"></i>
        </span>
        <input type="text" id="endDate" class="w-full pl-10 p-1.5 border border-gray-600 rounded bg-gray-800 text-white" placeholder="Date de fin" readonly>
    </div>
    <div id="calendar" class="absolute mt-2 p-4 bg-gray-900 text-white border border-gray-700 rounded-lg shadow-lg hidden z-50 flex">
        <!-- Suggested Dates Section -->
        <div class="flex flex-col space-y-2 mr-4">
            <button id="yesterday" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-clock-rotate-left mr-2"></i> Hier
            </button>
            <button id="today" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-calendar-check mr-2"></i> Aujourd'hui
            </button>
            <button id="thisWeek" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-calendar-check mr-2"></i> Cette semaine
            </button>
            <button id="thisMonth" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-calendar-check mr-2"></i> Ce mois
            </button>
            <button id="thisQuarter" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-calendar-check mr-2"></i> Ce trimestre
            </button>
            <button id="thisSemester" class="p-2 hover:bg-blue-700 text-white rounded flex items-center">
                <i class="fa-solid fa-calendar-check mr-2"></i> Ce semestre
            </button>
        </div>
        <!-- Calendar Section -->
        <div>
            <div class="flex justify-between items-center mb-2">
                <button id="prevMonth" class="p-1 hover:bg-gray-700 text-white rounded">
                    <i class="fa-solid fa-circle-chevron-left"></i>
                </button>
                <span id="monthYear" class="font-semibold"></span>
                <button id="nextMonth" class="p-1 hover:bg-gray-700 text-white rounded">
                    <i class="fa-solid fa-circle-chevron-right"></i>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-1 text-center">
                <div>Lu</div><div>Ma</div><div>Me</div><div>Je</div><div>Ve</div><div>Sa</div><div>Di</div>
            </div>
            <div id="days" class="grid grid-cols-7 gap-1 text-center mt-2"></div>
            <div class="flex mt-2 space-x-2">
                <button id="clearDates" class="w-1/2 p-2 bg-gray-600 hover:bg-gray-700 text-white text-center rounded-md">Clear</button>
                <button id="saveDates" class="w-1/2 p-2 bg-blue-600 hover:bg-blue-700 text-white text-center rounded-md">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const calendar = document.getElementById('calendar');
        const monthYear = document.getElementById('monthYear');
        const daysContainer = document.getElementById('days');
        const prevMonth = document.getElementById('prevMonth');
        const nextMonth = document.getElementById('nextMonth');
        const clearDates = document.getElementById('clearDates');
        const saveDates = document.getElementById('saveDates');
        const todayButton = document.getElementById('today');
        const yesterdayButton = document.getElementById('yesterday');
        const thisWeekButton = document.getElementById('thisWeek');
        const thisMonthButton = document.getElementById('thisMonth');
        const thisQuarterButton = document.getElementById('thisQuarter');
        const thisSemesterButton = document.getElementById('thisSemester');
    
        let currentDate = new Date();
        let selectedStartDate = null;
        let selectedEndDate = null;
        let activeInput = null;
        let isSelectingRange = false;
    
        function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
    
            monthYear.textContent = date.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
    
            daysContainer.innerHTML = '';
            for (let i = 1; i < firstDay; i++) {
                daysContainer.innerHTML += '<div></div>';
            }
    
            for (let day = 1; day <= lastDate; day++) {
                const dayElement = document.createElement('div');
                const currentDay = new Date(year, month, day);
                dayElement.textContent = day;
                dayElement.classList.add('p-2', 'cursor-pointer', 'hover:bg-gray-700', 'rounded');
                if (selectedStartDate && currentDay < selectedStartDate) {
                    dayElement.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    dayElement.addEventListener('click', () => selectDate(currentDay));
                }
                daysContainer.appendChild(dayElement);
            }
    
            highlightSelectedDates();
        }
    
        function selectDate(date) {
            if (isSelectingRange) {
                if (date >= selectedStartDate) {
                    selectedEndDate = date;
                    isSelectingRange = false;
                }
            } else {
                if (activeInput === startDateInput) {
                    selectedStartDate = date;
                    selectedEndDate = null;
                    isSelectingRange = true;
                } else if (activeInput === endDateInput) {
                    if (date >= selectedStartDate) {
                        selectedEndDate = date;
                    }
                } else {
                    if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                        selectedStartDate = date;
                        selectedEndDate = null;
                    } else {
                        selectedEndDate = date;
                    }
                }
            }
            updateDatepickerInput();
            highlightSelectedDates();
        }
    
        function updateDatepickerInput() {
            if (selectedStartDate) {
                startDateInput.value = selectedStartDate.toLocaleDateString('fr-FR');
            } else {
                startDateInput.value = '';
            }
            if (selectedEndDate) {
                endDateInput.value = selectedEndDate.toLocaleDateString('fr-FR');
            } else {
                endDateInput.value = '';
            }
        }
    
        function highlightSelectedDates() {
            const dayElements = daysContainer.querySelectorAll('div');
            dayElements.forEach(dayElement => {
                const day = parseInt(dayElement.textContent);
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                dayElement.classList.remove('bg-[#364056]', 'rounded-l-full', 'rounded-r-full', 'bg-blue-600', 'bg-blue-600', 'text-white');
                if (selectedStartDate && date.getTime() === selectedStartDate.getTime()) {
                    dayElement.classList.add('bg-blue-800', 'text-white', 'rounded-l-full');
                } else if (selectedEndDate && date.getTime() === selectedEndDate.getTime()) {
                    dayElement.classList.add('bg-blue-800', 'text-white', 'rounded-r-full');
                } else if (selectedStartDate && selectedEndDate && date >= selectedStartDate && date <= selectedEndDate) {
                    dayElement.classList.add('bg-blue-600', 'text-white');
                }
            });
        }
    
        function setToday() {
            const now = new Date();
            selectedStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            selectedEndDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(todayButton);
        }
    
        function setYesterday() {
            const now = new Date();
            selectedStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
            selectedEndDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(yesterdayButton);
        }
    
        function setThisWeek() {
            const now = new Date();
            const firstDayOfWeek = now.getDate() - now.getDay() + 1;
            selectedStartDate = new Date(now.setDate(firstDayOfWeek));
            selectedEndDate = new Date(now.setDate(firstDayOfWeek + 6));
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(thisWeekButton);
        }
    
        function setThisMonth() {
            const now = new Date();
            selectedStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
            selectedEndDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(thisMonthButton);
        }
    
        function setThisQuarter() {
            const now = new Date();
            const quarterStartMonth = Math.floor(now.getMonth() / 3) * 3;
            selectedStartDate = new Date(now.getFullYear(), quarterStartMonth, 1);
            selectedEndDate = new Date(now.getFullYear(), quarterStartMonth + 3, 0);
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(thisQuarterButton);
        }
    
        function setThisSemester() {
            const now = new Date();
            const semesterStartMonth = Math.floor(now.getMonth() / 6) * 6;
            selectedStartDate = new Date(now.getFullYear(), semesterStartMonth, 1);
            selectedEndDate = new Date(now.getFullYear(), semesterStartMonth + 6, 0);
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(thisSemesterButton);
        }
    
        function highlightButton(button) {
            const buttons = [yesterdayButton, todayButton, thisWeekButton, thisMonthButton, thisQuarterButton, thisSemesterButton];
            buttons.forEach(btn => btn.classList.remove('bg-blue-600', 'text-white'));
            if (button) {
                button.classList.add('bg-blue-600', 'text-white');
            }
        }
    
        startDateInput.addEventListener('click', () => {
            activeInput = startDateInput;
            calendar.style.top = `${startDateInput.offsetTop + startDateInput.offsetHeight}px`;
            calendar.style.left = `${startDateInput.offsetLeft}px`;
            calendar.classList.remove('hidden');
            renderCalendar(currentDate); // Ensure the calendar is updated immediately
        });
    
        endDateInput.addEventListener('click', () => {
            activeInput = endDateInput;
            calendar.style.top = `${endDateInput.offsetTop + endDateInput.offsetHeight}px`;
            calendar.style.left = `${endDateInput.offsetLeft}px`;
            calendar.classList.remove('hidden');
            renderCalendar(currentDate); // Ensure the calendar is updated immediately
        });
    
        prevMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        });
    
        nextMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        });
    
        clearDates.addEventListener('click', () => {
            selectedStartDate = null;
            selectedEndDate = null;
            isSelectingRange = false;
            updateDatepickerInput();
            highlightSelectedDates();
            highlightButton(null);
            renderCalendar(currentDate); // Ensure the calendar is re-rendered
        });
    
        saveDates.addEventListener('click', () => {
            calendar.classList.add('hidden');
        });
    
        todayButton.addEventListener('click', setToday);
        yesterdayButton.addEventListener('click', setYesterday);
        thisWeekButton.addEventListener('click', setThisWeek);
        thisMonthButton.addEventListener('click', setThisMonth);
        thisQuarterButton.addEventListener('click', setThisQuarter);
        thisSemesterButton.addEventListener('click', setThisSemester);
    
        document.addEventListener('click', (event) => {
            if (!calendar.contains(event.target) && event.target !== startDateInput && event.target !== endDateInput) {
                calendar.classList.add('hidden');
            }
        });
    
        renderCalendar(currentDate);
    });
    </script>